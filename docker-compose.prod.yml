services:
  siem-api:
    build: .
    container_name: mini-siem-backend
    restart: unless-stopped

    ports:
      - "127.0.0.1:8000:8000"

    environment:
      SIEM_DB_PATH: /data/siem.sqlite3
      SIEM_LOG_DIR: /logs

      # SIEM_ADMIN_PASSWORD_HASH: "..."
      # SIEM_JWT_SECRET: "..."
      # SIEM_CORS_ORIGINS: "https://twoj-frontend.netlify.app"

    volumes:
      - /srv/siem/data:/data
      - /srv/app_logs:/logs:ro

    healthcheck:
      test:
        [
          "CMD",
          "python",
          "-c",
          "import urllib.request; urllib.request.urlopen('http://127.0.0.1:8000/health').read()",
        ]
      interval: 30s
      timeout: 5s
      retries: 3
